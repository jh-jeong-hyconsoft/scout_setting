# ===== Septentrio SBi3 Pro+ 최종 ROS 2 파라미터 (Ethernet, RTK는 수신기 내부 연결) =====

# --- Device (수신기 SBF 스트림 접속) ---
device: tcp://192.168.50.21:6666     # 수신기 SBF over TCP 주소(웹 설정에서 포트 활성화 필요)

serial:                                # 시리얼 사용 시(여기선 이더넷이므로 무시됨)
  baudrate: 921600                     # 시리얼 보드레이트
  hw_flow_control: "off"               # 하드웨어 플로우 컨트롤

stream_device:                          # 드라이버가 외부로 재중계할 때(보통 미사용)
  tcp:
    ip_server: ""                      # TCP 리스트너(빈칸이면 비활성)
    port: 0
  udp:
    ip_server: ""                      # UDP 브로드캐스트(빈칸이면 비활성)
    port: 0
    unicast_ip: ""                     # 특정 유니캐스트 대상 IP

configure_rx: false                     # 드라이버가 수신기 메시지 구성/초기화 수행
custom_commands_file: "/home/scout/sensor_ws/src/septentrio_gnss_driver/config/AsteRx_SBi3_Pro+_config.txt"               # 부팅 시 실행할 수신기 커맨드 파일(SBF/CLI)

login:                                  # 일부 모델/설정에서 필요한 로그인(없으면 공란)
  user: ""
  password: ""

osnma:                                  # Galileo OSNMA 설정(필요 시만 사용)
  mode: "off"                           # off/on
  ntp_server: ""                        # OSNMA 관련 NTP 서버(선택)
  keep_open: true                       # 세션 유지

# --- Frames (URDF/TF 기준 이름과 정확히 일치해야 함) ---
frame_id: GNSS                          # 드라이버 메시지의 기본 frame_id(센서 본체 프레임)
imu_frame_id: GNSS                      # IMU가 부착된 본체 프레임명
poi_frame_id: base_link                 # 로봇 POI 기준 프레임(base_link로 변경하여 기존 TF 체인 유지)
vsm_frame_id: GNSS_ant2                 # VSM 프레임(미사용이면 임의/불문, 여기선 보조 안테나와 동일명 사용해도 무방)
aux1_frame_id: GNSS_ant2                # 보조(AUX1) 안테나 프레임 = GNSS_ant2

vehicle_frame_id: base_link             # 차량(로봇) 기준 프레임(base_link로 변경)
local_frame_id: odom                    # 지역 좌표 프레임명(필요 시 사용)

insert_local_frame: false               # 로컬 프레임 삽입 여부 (TF 퍼블리시 안 하므로 불필요)
get_spatial_config_from_tf: false       # TF에서 레버암/자세를 자동 추출할지 여부(false면 아래 수치 사용)
lock_utm_zone: true                     # UTM 존 고정(지도 프레임 일관성)
use_ros_axis_orientation: true          # ROS 좌표 규약(x fwd, y left, z up) 사용

receiver_type: ins                     # 수신기 유형(gnss/ins 등, 자동 인지되는 경우가 많음)
multi_antenna: true                     # 듀얼 안테나 사용(헤딩 산출)
datum: Default                          # 기준 타원체/데이텀(필요 시 변경)

# POI → ARP(안테나) 오프셋(미사용; 주 안테나는 아래 ant_lever_arm으로 지정)
poi_to_arp:
  delta_e: 0.0                          # 동(E) 방향(m)
  delta_n: 0.0                          # 북(N) 방향(m)
  delta_u: 0.0                          # 상(U) 방향(m)

# 듀얼 안테나 자세 오프셋(기구 오차 있을 때 보정, deg)
att_offset:
  heading: 0.0                          # 요(헤딩) 보정
  pitch: 0.0                            # 피치 보정

ant_type: "Unknown"                     # 안테나 타입(선택)
ant_serial_nr: "Unknown"                # 안테나 S/N(선택)
ant_aux1_type: "Unknown"                # AUX1 안테나 타입(선택)
ant_aux1_serial_nr: "Unknown"           # AUX1 안테나 S/N(선택)

# 폴링 주기(ms) - 수신기 상태/측정 주기
polling_period:
  pvt: 100                              # PVT/상태 폴링 주기
  rest: 500                             # 그 외 메시지 폴링 주기

# --- Time / Clock ---
use_gnss_time: false                     # GNSS 시간으로 메시지 타임스탬프 생성(권장)
ntp_server: false                       # 드라이버의 NTP 서버 기능(일반적으로 불필요)
ptp_server_clock: false                 # PTP 서버 클럭 사용 여부
latency_compensation: true              # 시간 지연 보정(권장)

# --- RTK 입력 (수신기 내부에서 NTRIP 연결 완료 가정: 여기서는 비활성) ---
rtk_settings:
  ntrip_1:
    id: ""                              # NTRIP 세션 이름(미사용)
    caster: ""                          # 캐스터 주소(미사용)
    caster_port: 2101                   # 캐스터 포트(미사용)
    username: ""                        # 계정(미사용)
    password: ""                        # 비밀번호(미사용)
    mountpoint: ""                      # 마운트포인트(미사용)
    version: "v2"                       # NTRIP 버전
    tls: false                          # TLS 사용 여부
    fingerprint: ""                     # TLS 핑거프린트
    rtk_standard: "auto"                # RTCM/CMR 등 자동
    send_gga: "auto"                    # GGA 송신 정책
    keep_open: false                    # 드라이버에서 NTRIP 연결 유지하지 않음(내부 연결 사용)
  ip_server_1:
    id: ""                              # IP RTCM 입력(미사용)
    port: 0
    rtk_standard: "auto"
    send_gga: "auto"
    keep_open: false
  serial_1:
    port: ""                            # 시리얼 RTCM 입력(미사용)
    baud_rate: 115200
    rtk_standard: "auto"
    send_gga: "auto"
    keep_open: false

# --- Publish (ROS 토픽 출력 설정) ---
publish:
  auto_publish: false                   # 가능한 메시지 자동 퍼블리시 (false로 하여 TF 자동 퍼블리시 방지)
  publish_only_valid: false              # 유효한 솔루션만 퍼블리시(FIX/Float 등)
  navsatfix: true                       # sensor_msgs/NavSatFix (호환성 높음)
  gpsfix: true                          # gps_common/GPSFix (정밀 필드 포함)
  gpgga: false                          # NMEA GGA(필요 시 true)
  gprmc: false                          # NMEA RMC
  gpst: false                           # 시간 메시지
  measepoch: false                      # 원시 측정 epoch
  pvtcartesian: false                   # PVT(ENU/Cart) 퍼블리시
  pvtgeodetic: true                     # PVT(Geodetic) 퍼블리시
  basevectorcart: false                 # 베이스라인(카테시안)
  basevectorgeod: false                 # 베이스라인(지리좌표)
  poscovcartesian: false                # 위치 공분산(카테시안)
  poscovgeodetic: true                  # 위치 공분산(지리좌표)
  velcovcartesian: false                # 속도 공분산(카테시안)
  velcovgeodetic: true                  # 속도 공분산(지리좌표)
  atteuler: true                        # 자세(Euler, 듀얼안테나/INS)
  attcoveuler: true                     # 자세 공분산
  pose: false                           # geometry_msgs/Pose 출력
  twist: false                          # geometry_msgs/Twist 출력
  diagnostics: true                     # 드라이버/수신기 진단
  aimplusstatus: true                   # AIM+ 상태(간섭/무결성)
  galauthstatus: false                  # Galileo 인증 상태
  # GNSS 전용 NMEA
  gpgsa: false
  gpgsv: false
  # INS 전용
  insnavcart: false                     # INS Nav(카테시안)
  insnavgeod: true                      # INS Nav(지리좌표: 위치/속도/자세)
  extsensormeas: false                  # 외부 센서 측정 수신
  imusetup: true                        # IMU 설정 메시지
  velsensorsetup: false                 # 속도 센서 설정
  exteventinsnavcart: false             # 외부 이벤트(카테시안)
  exteventinsnavgeod: false             # 외부 이벤트(지리좌표)
  imu: true                             # sensor_msgs/Imu 출력
  localization: false                   # 로컬라이제이션 결과(미사용)
  tf: false                             # TF 브로드캐스트(이미 robot_state_publisher 사용)
  localization_ecef: false              # ECEF 로컬라이제이션
  tf_ecef: false                        # ECEF TF

# --- INS Spatial Config (URDF 실측치 반영) ---
ins_spatial_config:
  # IMU 축 보정(ROS 축과 다르면 각도 보정; deg). URDF rpy=0 → 0 유지
  imu_orientation:
    theta_x: 0.0                        # 롤 보정(+)는 x축 회전
    theta_y: 0.0                        # 피치 보정(+)는 y축 회전
    theta_z: 0.0                        # 요 보정(+)는 z축 회전

  # POI(= base_link) 레버암: 로봇 기준점 자체를 사용 → 0
  poi_lever_arm:
    delta_x: 0.0                        # x 앞(+)
    delta_y: 0.0                        # y 좌(+)
    delta_z: 0.0                        # z 위(+)

  # 주(Primary) GNSS 안테나 레버암: base_link → GNSS_ant1
  #   URDF에서 base_link -> main_frame_link -> GNSS_ant1 거리 확인 필요
  #   현재는 임시로 이전 값 유지 (base_link 기준으로 재계산 필요할 수 있음)
  ant_lever_arm:
    x: 0.454                            # m (base_link 기준으로 확인 필요)
    y: 0.354                            # m (base_link 기준으로 확인 필요)
    z: 0.205                            # m (base_link 기준으로 확인 필요)

  # VSM(속도센서) 레버암(미사용 시 0)
  vsm_lever_arm:
    vsm_x: 0.0
    vsm_y: 0.0
    vsm_z: 0.0

ins_initial_heading: auto               # 초기 헤딩 추정 방식(auto 권장)
ins_std_dev_mask:                        # INS 솔루션 허용 표준편차 상한
  att_std_dev: 5.0                       # 자세(deg) 허용치
  pos_std_dev: 10.0                      # 위치(m) 허용치
ins_use_poi: true                        # INS 해에 POI(로봇 기준점) 사용

# 외부 속도센서/VSM 입력 설정(미사용)
ins_vsm:
  ros:
    source: ""                           # ROS 토픽 속도 입력 소스
    config: [false, false, false]        # 사용 축 지정
    variances_by_parameter: false        # 분산 파라미터 사용 여부
    variances: [0.0, 0.0, 0.0]           # 분산 값
  ip_server:
    id: ""                               # IP 입력 설정
    port: 0
    keep_open: true
  serial:
    port: ""                             # 시리얼 입력 설정
    baud_rate: 115200
    keep_open: true

# --- Logger ---
activate_debug_log: true                # 디버그 로그 활성화(문제 추적 시 true 권장)
